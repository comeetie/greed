---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/",
  out.width = "60%"
)
```




# GREED : Bayesian greedy clustering
<!-- badges: start -->
[![R build status](https://github.com/comeetie/greed/workflows/R-CMD-check/badge.svg)](https://github.com/comeetie/greed/actions)
[![CRAN status](https://www.r-pkg.org/badges/version/greed)](https://CRAN.R-project.org/package=greed)
<!-- badges: end -->

Greed enables model based clustering of networks, matrices of count data and much more with different types of generative models. Model selection and clustering is performed in combination by optimizing the Integrated Classification Likelihood. Details of the algorithms and methods proposed by this package can be found in Côme, Jouvin, Latouche, and Bouveyron (2021) [10.1007/s11634-021-00440-z](https://doi.org/10.1007/s11634-021-00440-z).

<img src="man/figures/greed.png" width=200 align="right" />

The following generative models are available currently : 

* **Stochastic Block Models** (see ``?`Sbm-class` ``),
* **Degree Corrected Stochastic Block Models** (see ``?`DcSbm-class` ``),
* **Multinomial Stochastic Block Models** (see ``?`MultSbm-class` ``),
* **Mixture of Multinomials** (see ``?`MoR-class` ``), 
* **Latent Class Analysis** (see ``?`Lca-class` ``), 
* **Gaussian Mixture Model** (see ``?`Gmm-class` `` and ``?`DiagGmm-class` ``),
* **Multivariate Mixture of Gaussian Regression Model** (see ``?`MoR-class` ``),
* **Degree Corrected Latent Block Model** (see ``?`DcLbm-class` ``).
* **Mixed Dlvm's** (see ``?`MixedModels-class` ``).


With the Integrated Classification Likelihood, the parameters of the models are integrated out. This allows a natural regularization for complex models. Since the Integrated Classification Likelihood penalizes complex models it allows to automatically find a "natural" value for the number of clusters $K^*$, the user only needs to provide an initial guess as well as values for the prior parameters (sensible default values are used if no prior information is available). The optimization is performed by default thanks to a combination of a greedy local search and a genetic algorithm. Several optimization algorithms are available.

Eventually, the whole path of solutions from $K^*$ to 1 cluster is extracted. This enables a partial ordering of the clusters, and the evaluation of simpler clustering. The package also provides some plotting functionality.


## Installation

You can install the development version of greed from [GitHub](https://github.com/) with:

``` r
#GitHub
install.packages("devtools")
devtools::install_github("comeetie/greed")
```

Or use the CRAN version:
``` r
#CRAN
install.packages("greed")
```

## Usage

The main entry point for using the package is simply the greed function (`?greed`). The generative model will be chosen automatically to fit with the data provided, but you may specify another choice with the model parameter. This is a basic example with the classical Books network `?Books`:

```{r example}
library(greed)
data(Books)
sol <- greed(Books$X)
```
You may specify the model you want to use and set the priors parameters with the (model argument), the optimization algorithm (alg argument) and the initial number of cluster K. Here football is a square sparse matrix and a graph clustering ``?`DcSbm-class` `` model will be used by default, and the Hybrid genetic algorithm greed used. 



```{r sbm-example}
sol <- greed(Books$X,model=Sbm(),alg=Seed(),K=10)
```


Some plotting function enable the exploration of the clustering results, the hierarchical structure between clusters:
```{r plot,message=FALSE,results="hide"}
plot(sol)
```

Or a summary représentation of the adjacency matrix:
```{r tree}
plot(sol,type='blocks')
```

You may extract the model fitted parameters with the `?coef` function, the clustering with the `?clustering` function, the value of ICL with `?ICL`:

```{r}
ICL(sol)
coef(sol)
table(clustering(sol))
```


Eventually, one may explore some coarser clustering using the cut function:
```{r cut}
plot(cut(sol,3))
```


For large datasets, it is possible to use parallelism to speed-up the computation thanks to the [future](https://github.com/HenrikBengtsson/future) package. You only need to specify the type of backend you want to use, before calling the `?greed` function:
```{r future}
library(future)
plan(multisession)
```

## Typical use cases

### Classical clustering, GMM

See the `vignette("GMM")` for details.

```{r diabetes-gmm, fig.show='hold',out.width="90%",fig.width=8,fig.height=5.5}
data("diabetes",package = "mclust")
X <- diabetes[,-1]
sol <- greed(X,model=Gmm())
table(diabetes$cl,clustering(sol))
gmmpairs(sol,X)
```


### Questionnary and item response theory datasets, LCA

See the `vignette("LCA")` for details.

### Graphs, SBM like models

See the `vignette("SBM")` for details.

### Mixture of Regression

See the`vignette("MoR")` for details.

### Advanced models`

See the `vignette("Mixed Models")`for details.