<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mixed Models • greed</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mixed Models">
<meta property="og:description" content="greed">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">greed</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SBM.html">Graph clustering</a>
    </li>
    <li>
      <a href="../articles/GMM.html">Gaussian Mixture Models</a>
    </li>
    <li>
      <a href="../articles/MoR.html">Mixture of Regressions</a>
    </li>
    <li>
      <a href="../articles/LCA.html">Latent Class Analysis</a>
    </li>
    <li>
      <a href="../articles/Mixed-Models.html">Mixed Models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a>
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/comeetie/greed">github</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Mixed-Models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mixed Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/comeetie/greed/blob/master/vignettes/Mixed-Models.Rmd"><code>vignettes/Mixed-Models.Rmd</code></a></small>
      <div class="hidden name"><code>Mixed-Models.Rmd</code></div>

    </div>

    
    
<p>Loads packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://comeetie.github.io/greed/">greed</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mclust-org.github.io/mclust/">mclust</a></span><span class="op">)</span>
<span class="co">#&gt; Package 'mclust' version 5.4.8</span>
<span class="co">#&gt; Type 'citation("mclust")' for citing this R package in publications.</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2134</span><span class="op">)</span></code></pre></div>
<div id="mixed-models-clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#mixed-models-clustering" class="anchor"></a>Mixed Models clustering</h2>
<p>One of distinctive feature of greed is that you may mix several model together. Using such an approach one may perform a simultaneous clustering of several view of the same individuals with different generative models. In all case this approach suppose that the different view are generated in an independent way when the clustering assignment is known. To explore this capability we will begin with the Fifa dataset and cluster simultaneously the categorical features with an Lca and the continuous one with a Gmm.</p>
<div id="the-fifa-data-set-lca-gmm" class="section level3">
<h3 class="hasAnchor">
<a href="#the-fifa-data-set-lca-gmm" class="anchor"></a>The Fifa data-set Lca + GMM</h3>
<p>We first load the Fifa dataset that correspond to several feature of Soccer players in the Fifa 2020 videogame. We remove the first two columns that give the players names and nationality, and we kept only the players which earn more than 3000000 euros.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Fifa</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Fifa</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">value_eur</span><span class="op">&gt;</span><span class="fl">3000000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">value_eur</span>,<span class="op">-</span><span class="va">GK</span>,<span class="op">-</span><span class="va">pos_x</span>,<span class="op">-</span><span class="va">pos_y</span><span class="op">)</span></code></pre></div>
<p>This leave us with a dataset of <span class="math inline">\(n=3345\)</span> rows and <span class="math inline">\(p=24\)</span> columns. The features correspond to players characteristics (age,height,weight), skills scores (pace,shooting,…) and a set of binary factors that describe the field position were the players may be aligned.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="co">#&gt;  preferred_foot      age          height_cm       weight_kg     </span>
<span class="co">#&gt;  Left : 846     Min.   :16.00   Min.   :157.0   Min.   : 56.00  </span>
<span class="co">#&gt;  Right:2499     1st Qu.:24.00   1st Qu.:176.0   1st Qu.: 70.00  </span>
<span class="co">#&gt;                 Median :26.00   Median :181.0   Median : 75.00  </span>
<span class="co">#&gt;                 Mean   :26.32   Mean   :180.8   Mean   : 75.44  </span>
<span class="co">#&gt;                 3rd Qu.:29.00   3rd Qu.:186.0   3rd Qu.: 80.00  </span>
<span class="co">#&gt;                 Max.   :38.00   Max.   :201.0   Max.   :101.00  </span>
<span class="co">#&gt;       pace          shooting        passing        dribbling    </span>
<span class="co">#&gt;  Min.   :31.00   Min.   :18.00   Min.   :35.00   Min.   :34.00  </span>
<span class="co">#&gt;  1st Qu.:65.00   1st Qu.:55.00   1st Qu.:62.00   1st Qu.:68.00  </span>
<span class="co">#&gt;  Median :72.00   Median :67.00   Median :68.00   Median :73.00  </span>
<span class="co">#&gt;  Mean   :71.35   Mean   :62.56   Mean   :67.02   Mean   :71.74  </span>
<span class="co">#&gt;  3rd Qu.:79.00   3rd Qu.:72.00   3rd Qu.:73.00   3rd Qu.:77.00  </span>
<span class="co">#&gt;  Max.   :96.00   Max.   :93.00   Max.   :92.00   Max.   :96.00  </span>
<span class="co">#&gt;    defending         physic          RW           CF           ST      </span>
<span class="co">#&gt;  Min.   :18.00   Min.   :35.00   FALSE:3071   FALSE:3226   FALSE:2610  </span>
<span class="co">#&gt;  1st Qu.:39.00   1st Qu.:65.00   TRUE : 274   TRUE : 119   TRUE : 735  </span>
<span class="co">#&gt;  Median :65.00   Median :71.00                                         </span>
<span class="co">#&gt;  Mean   :57.61   Mean   :70.14                                         </span>
<span class="co">#&gt;  3rd Qu.:73.00   3rd Qu.:76.00                                         </span>
<span class="co">#&gt;  Max.   :90.00   Max.   :90.00                                         </span>
<span class="co">#&gt;      LW          CAM           CM           CB          CDM           LM      </span>
<span class="co">#&gt;  FALSE:3070   FALSE:2758   FALSE:2440   FALSE:2652   FALSE:2710   FALSE:2807  </span>
<span class="co">#&gt;  TRUE : 275   TRUE : 587   TRUE : 905   TRUE : 693   TRUE : 635   TRUE : 538  </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;      LB           RB           RM          LWB          RWB      </span>
<span class="co">#&gt;  FALSE:3035   FALSE:3027   FALSE:2805   FALSE:3283   FALSE:3290  </span>
<span class="co">#&gt;  TRUE : 310   TRUE : 318   TRUE : 540   TRUE :  62   TRUE :  55  </span>
<span class="co">#&gt;                                                                  </span>
<span class="co">#&gt;                                                                  </span>
<span class="co">#&gt;                                                                  </span>
<span class="co">#&gt; </span></code></pre></div>
<p>Preparing the data and the model is a little bit complicated than for the other models since we must specify the different models we want to use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>
<span class="co"># prepare the dataset create a list with the factor colums in one slot and the numeric columns in another slot</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>categorical <span class="op">=</span> <span class="va">X</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>,
            cont <span class="op">=</span> <span class="va">X</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">{</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">is.factor</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="co"># create the MixedModels, as expected we will use an LcaPrior for the factors and a GmmPrior for the numeric columns.</span>
<span class="co"># !be carefull names in the models list and in the data list must match</span>
<span class="va">mixmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MixedModels-class.html">MixedModels</a></span><span class="op">(</span>models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>categorical<span class="op">=</span><span class="fu"><a href="../reference/LcaPrior-class.html">LcaPrior</a></span><span class="op">(</span><span class="op">)</span>,cont<span class="op">=</span><span class="fu"><a href="../reference/GmmPrior-class.html">GmmPrior</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># perform the clustering</span>
<span class="va">sol</span> <span class="op">=</span> <span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">data</span>,model <span class="op">=</span> <span class="va">mixmod</span><span class="op">)</span>
<span class="co">#&gt; ------- MIXEDMODELS model fitting ------</span>
<span class="co">#&gt; ################# Generation  1: best solution with an ICL of -107151 and 9 clusters #################</span>
<span class="co">#&gt; ################# Generation  2: best solution with an ICL of -107109 and 9 clusters #################</span>
<span class="co">#&gt; ################# Generation  3: best solution with an ICL of -107081 and 8 clusters #################</span>
<span class="co">#&gt; ################# Generation  4: best solution with an ICL of -107038 and 7 clusters #################</span>
<span class="co">#&gt; ################# Generation  5: best solution with an ICL of -107036 and 7 clusters #################</span>
<span class="co">#&gt; ################# Generation  6: best solution with an ICL of -107034 and 7 clusters #################</span>
<span class="co">#&gt; ################# Generation  7: best solution with an ICL of -107033 and 7 clusters #################</span>
<span class="co">#&gt; ################# Generation  8: best solution with an ICL of -107033 and 7 clusters #################</span>
<span class="co">#&gt; ------- Final clustering -------</span>
<span class="co">#&gt; ICL clustering with a MIXEDMODELS model, 7 clusters and an icl of -107033.</span></code></pre></div>
<p>When the model is fitted the <code><a href="../reference/extractSubModel.html">extractSubModel()</a></code> function allow to retrieve the fitted sub-models, and use the plotting capabilities of each of them. We may for example look at the categorical part of the model and make a <code>marginals</code> plot. We see with this figure that the clusters found agree quite strongly with the field positions features. The preferred foot feature has also an impact on cluster 2 and 3.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractSubModel.html">extractSubModel</a></span><span class="op">(</span><span class="va">sol</span>,<span class="st">"categorical"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"marginals"</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/genplotcat-1.png" width="100%"></p>
<p>When looking at the continuous features the clusters are quite well organized, the hierarchical ordering has produced a meaningful ordering, look at the shooting feature. We will go back to this point later.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractSubModel.html">extractSubModel</a></span><span class="op">(</span><span class="va">sol</span>,<span class="st">"cont"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"violins"</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/genplotviol-1.png" width="100%"></p>
<p>For the marginals plots, one things that pop out is the clear bimodal aspect of the defending features, the mixture of the remaining feature is clearly not so well separated.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractSubModel.html">extractSubModel</a></span><span class="op">(</span><span class="va">sol</span>,<span class="st">"cont"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"marginals"</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/genplotmar-1.png" width="100%"> To clearly show, the alignment of the cluster with field position we will make a little figure and plot for each cluster their mean position on the field. This will be computed as the weighted average coordinate of each field position were the weight correspond to the probability that a cluster member can play at this position.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"Fifa_positions"</span><span class="op">)</span>
<span class="va">params</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractSubModel.html">extractSubModel</a></span><span class="op">(</span><span class="va">sol</span>,<span class="st">"categorical"</span><span class="op">)</span><span class="op">)</span>

<span class="va">pos_clust</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/K.html">K</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">Thetak</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">Thetak</span><span class="op">)</span><span class="op">]</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="fl">1</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="va">k</span>,<span class="fl">1</span><span class="op">]</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">pos_clust</span><span class="op">$</span><span class="va">cluster</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/K.html">K</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">)</span>

<span class="va">pos_clust_long</span> <span class="op">=</span> <span class="va">pos_clust</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">pos_clust</span><span class="op">)</span>,names_to <span class="op">=</span> <span class="st">"position"</span>,values_to <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">Fifa_positions</span><span class="op">$</span><span class="va">positions</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"position"</span><span class="op">=</span><span class="st">"team_position"</span><span class="op">)</span><span class="op">)</span>

<span class="va">pos_clust_mean</span> <span class="op">=</span> <span class="va">pos_clust_long</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">p</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">p</span><span class="op">)</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pos_clust_mean</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/background_image.html">background_image</a></span><span class="op">(</span><span class="va">Fifa_positions</span><span class="op">$</span><span class="va">bg_img</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,label<span class="op">=</span><span class="va">cluster</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">5</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">203.2</span><span class="op">)</span>,expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">101.6</span><span class="op">)</span>,expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/posplot-1.png" width="90%"></p>
<p>The organisation of the clusters clearly appears, cluster 1 correspond to central defensive players, cluster 2 and 3 to lateral defensive players (recall that the preferred foot of this player were quite different between this two clusters with almost only right footed players in cluster 2 and left footed players in cluster 3).</p>
</div>
<div id="the-ndrangheta-data-set-sbm-lca" class="section level3">
<h3 class="hasAnchor">
<a href="#the-ndrangheta-data-set-sbm-lca" class="anchor"></a>The Ndrangheta data-set Sbm + Lca</h3>
<p>Mixed models may also be used to analyse graph datasets with node attribute for example. To demonstrate this feature we will use the Ndrangeta dataset. This dataset contains relationship information between members of the Ndrangheta mafia together with some information on their group affiliation and their role. We wil use an Sbm model to fit the adjacency matrix and an Lca model for the facotr describing the roles.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># laod the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Ndrangheta</span><span class="op">)</span>
<span class="co"># prepare the data </span>
<span class="va">data</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>graph<span class="op">=</span><span class="va">Ndrangheta</span><span class="op">$</span><span class="va">X</span>,node_infos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Role<span class="op">=</span><span class="va">Ndrangheta</span><span class="op">$</span><span class="va">node_meta</span><span class="op">$</span><span class="va">Role</span>,stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co"># build the mixed model</span>
<span class="va">mixmod</span> <span class="op">=</span> <span class="fu"><a href="../reference/MixedModels-class.html">MixedModels</a></span><span class="op">(</span>models<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>graph<span class="op">=</span><span class="fu"><a href="../reference/SbmPrior-class.html">SbmPrior</a></span><span class="op">(</span><span class="op">)</span>,node_infos<span class="op">=</span><span class="fu"><a href="../reference/LcaPrior-class.html">LcaPrior</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># cluster</span>
<span class="va">sol</span><span class="op">=</span><span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">data</span>,model<span class="op">=</span><span class="va">mixmod</span><span class="op">)</span>
<span class="co">#&gt; ------- MIXEDMODELS model fitting ------</span>
<span class="co">#&gt; ################# Generation  1: best solution with an ICL of -2582 and 16 clusters #################</span>
<span class="co">#&gt; ################# Generation  2: best solution with an ICL of -2412 and 22 clusters #################</span>
<span class="co">#&gt; ################# Generation  3: best solution with an ICL of -2398 and 23 clusters #################</span>
<span class="co">#&gt; ################# Generation  4: best solution with an ICL of -2398 and 23 clusters #################</span>
<span class="co">#&gt; ------- Final clustering -------</span>
<span class="co">#&gt; ICL clustering with a MIXEDMODELS model, 22 clusters and an icl of -2367.</span>
<span class="co"># analyse the results</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractSubModel.html">extractSubModel</a></span><span class="op">(</span><span class="va">sol</span>,<span class="st">"graph"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"blocks"</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/extractSubModel.html">extractSubModel</a></span><span class="op">(</span><span class="va">sol</span>,<span class="st">"node_infos"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"marginals"</span><span class="op">)</span></code></pre></div>
<p><img src="Mixed-Models_files/figure-html/unnamed-chunk-2-3.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Etienne Côme, Nicolas Jouvin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
