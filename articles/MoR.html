<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoR • greed</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MoR">
<meta property="og:description" content="greed">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">greed</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GMM.html">Gaussian Mixture Models</a>
    </li>
    <li>
      <a href="../articles/LCA.html">Latent Class Analysis</a>
    </li>
    <li>
      <a href="../articles/MoR.html">Mixture of Regressions</a>
    </li>
    <li>
      <a href="../articles/SBM.html">Graph clustering</a>
    </li>
    <li>
      <a href="../articles/CombinedModels.html">Combined Models</a>
    </li>
    <li>
      <a href="../articles/MoM.html">Mixture of Multinomials</a>
    </li>
    <li>
      <a href="../articles/LBM.html">Co-clustering and LBM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a>
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/comeetie/greed" class="external-link">github</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MoR_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MoR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/comeetie/greed/blob/HEAD/vignettes/MoR.Rmd" class="external-link"><code>vignettes/MoR.Rmd</code></a></small>
      <div class="hidden name"><code>MoR.Rmd</code></div>

    </div>

    
    
<style type="text/css">
p.caption {
  font-style: italic;
}
</style>
<p>Loads packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span> <span class="co"># allows parralel processing in greed()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://comeetie.github.io/greed/" class="external-link">greed</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mclust-org.github.io/mclust/" class="external-link">mclust</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2134</span><span class="op">)</span>

<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># may be increased </span></code></pre></div>
<div class="section level2">
<h2 id="mixture-of-regression">Mixture of Regression<a class="anchor" aria-label="anchor" href="#mixture-of-regression"></a>
</h2>
<p>Mixture of Regressions as their name suggest fit several regression models at the same time and try to extract a partition where different regression models holds for each subsets. Formally, the Bayesian version of this model with invariant priors is given by the following generative model.</p>
<p><span class="math display">\[
\begin{align}
\pi &amp;\sim Dirichlet(\alpha)\\
Z_i  &amp;\sim \mathcal{M}(1,\pi)\\
 V_k &amp;\sim \mathcal{W}(\varepsilon^{-1},n_0)\\
 A_k|V_k,X &amp;\sim \mathcal{MN}(0,(V_k)^{-1},\tau X^{t}X)\\
 Y_{i.}|X_{i.},Z_{ik}=1 &amp;\sim \mathcal{N}(A_kx_{i.},V_{k}^{-1})
 \end{align}
\]</span> with <span class="math inline">\(\mathcal{MN}()\)</span> the matrix normal distribution and <span class="math inline">\(\mathcal{W}()\)</span> the Whishart distribution. The prior parameters may therefore have an impact on the results and they can’t be non-informative. The main prior parameters to look at are <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\varepsilon\)</span>. <span class="math inline">\(\tau\)</span> define the strength of the regularization applied on the regression problem, by default it equals <span class="math inline">\(0.01\)</span>, <span class="math inline">\(\varepsilon\)</span> and <span class="math inline">\(n_0\)</span> define the prior for the noise co-variance matrix. By default, it will be equal to 0.1 time the variance of the regression residuals with only one cluster and <span class="math inline">\(n_0\)</span> is fixed by default to <span class="math inline">\(d\)</span> the dimension of <span class="math inline">\(y\)</span> for the prior to be as uninformative as possible.</p>
<div class="section level4">
<h4 id="an-introductory-example">An introductory example<a class="anchor" aria-label="anchor" href="#an-introductory-example"></a>
</h4>
<p>To introduce this model we will use a small toy artificial dataset from the <code>flexmix</code> package. The dataset correspond to two groups. One with a linear relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> and a second with a quadratic relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NPreg"</span>, package <span class="op">=</span> <span class="st">"flexmix"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">NPreg</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">yn</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="MoR_files/figure-html/unnamed-chunk-3-1.png" width="624" style="display: block; margin: auto;"> To fit a mixture of regression model with greed, you must provide a <code>data.frame</code> and a <code>MoR</code> model. To build such a model, we simply use the <code>MoR</code> function which has one mandatory argument, the formula of the supposed regression model. In our toy case, we may thus use the following line of code to fit the clustering model using a polynomial regression model of degree two:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sol</span><span class="op">=</span><span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">NPreg</span>,model<span class="op">=</span><span class="fu"><a href="../reference/MoR.html">MoR</a></span><span class="op">(</span><span class="va">yn</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Fitting a MOR model</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Initializing a population of 20 solutions.</span>
<span class="co">#&gt; ℹ Generation 1 : best solution with an ICL of -675 and 2 clusters.</span>
<span class="co">#&gt; ℹ Generation 2 : best solution with an ICL of -675 and 2 clusters.</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Final clustering</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Clustering with a MOR model 2 clusters and an ICL of -675</span></code></pre></div>
<p>As expected the partition with two cluster that was used to simulate the data is recovered by the algorithm. When, the clustering is performed, we may use the classical functions <code>clustering,coef,prior,plot,...</code> to explore the results. We may start by comparing the found clustering with the true labels :</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="../reference/clustering.html">clustering</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">cl</span>,<span class="va">NPreg</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>
<span class="co">#&gt;    </span>
<span class="co">#&gt; cl   1  2</span>
<span class="co">#&gt;   1  4 95</span>
<span class="co">#&gt;   2 96  5</span></code></pre></div>
<p>Look at the value used for the prior parameters :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="co">#&gt; An object of class "MoR"</span>
<span class="co">#&gt; Slot "formula":</span>
<span class="co">#&gt; yn ~ x + I(x^2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "tau":</span>
<span class="co">#&gt; [1] 0.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "N0":</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "epsilon":</span>
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 16.88241</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "alpha":</span>
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>Extract the MAP model coefficient for further use :</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="va">params</span>
<span class="co">#&gt; $pi</span>
<span class="co">#&gt;       [,1]</span>
<span class="co">#&gt; [1,] 0.495</span>
<span class="co">#&gt; [2,] 0.505</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $A</span>
<span class="co">#&gt; $A$cluster1</span>
<span class="co">#&gt;                     yn</span>
<span class="co">#&gt; (Intercept) 13.1690893</span>
<span class="co">#&gt; x            9.0655610</span>
<span class="co">#&gt; I(x^2)      -0.8937771</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $A$cluster2</span>
<span class="co">#&gt;                      yn</span>
<span class="co">#&gt; (Intercept) -0.33244435</span>
<span class="co">#&gt; x            4.42810766</span>
<span class="co">#&gt; I(x^2)       0.03041496</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Sigmak</span>
<span class="co">#&gt; $Sigmak$cluster1</span>
<span class="co">#&gt;         yn</span>
<span class="co">#&gt; yn 11.7112</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Sigmak$cluster2</span>
<span class="co">#&gt;          yn</span>
<span class="co">#&gt; yn 11.32306</span></code></pre></div>
<p>And plot prediction line of the fitted sub-models:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df.pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,length.out<span class="op">=</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>
<span class="va">X</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,<span class="va">df.pred</span><span class="op">)</span>
<span class="va">df.mpred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">A</span>,<span class="kw">function</span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">A</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df.mpred</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster1"</span>,<span class="st">"cluster2"</span><span class="op">)</span>
<span class="va">df.mpred</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="va">df.pred</span><span class="op">$</span><span class="va">x</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">NPreg</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">yn</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df.mpred</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">cluster1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df.mpred</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">cluster2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="MoR_files/figure-html/unnamed-chunk-8-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="an-more-challenging-application-with-the-fifa-dataset">An more challenging application with the Fifa dataset<a class="anchor" aria-label="anchor" href="#an-more-challenging-application-with-the-fifa-dataset"></a>
</h4>
<p>For this example we will use the Fifa dataset and take a subsample of 2000 players:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Fifa"</span><span class="op">)</span>
<span class="va">Xreg</span><span class="op">=</span><span class="va">Fifa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value_eur</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>,<span class="va">as.factor</span><span class="op">)</span></code></pre></div>
<p>We will try to predict the log of the player value from it’s age and ability scores. We therefore define the model and run the clustering in a similar fashion as previously:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reg_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">value_eur</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">pace</span> <span class="op">+</span> <span class="va">shooting</span> <span class="op">+</span> <span class="va">dribbling</span> <span class="op">+</span> <span class="va">passing</span> <span class="op">+</span> <span class="va">defending</span>  <span class="op">+</span> <span class="va">physic</span>
<span class="va">mod_reg</span> <span class="op">=</span> <span class="fu"><a href="../reference/MoR.html">MoR</a></span><span class="op">(</span><span class="va">reg_formula</span><span class="op">)</span>
<span class="va">sol</span><span class="op">=</span><span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">Xreg</span>,<span class="va">mod_reg</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Fitting a MOR model</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Initializing a population of 20 solutions.</span>
<span class="co">#&gt; ℹ Generation 1 : best solution with an ICL of -2395 and 2 clusters.</span>
<span class="co">#&gt; ℹ Generation 2 : best solution with an ICL of -2340 and 3 clusters.</span>
<span class="co">#&gt; ℹ Generation 3 : best solution with an ICL of -2325 and 2 clusters.</span>
<span class="co">#&gt; ℹ Generation 4 : best solution with an ICL of -2325 and 2 clusters.</span>
<span class="co">#&gt; ℹ Generation 5 : best solution with an ICL of -2325 and 2 clusters.</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Final clustering</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Clustering with a MOR model 2 clusters and an ICL of -2325</span></code></pre></div>
<p>The clustering found has two clusters, if we look at the regression models parameters :</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl</span><span class="op">=</span><span class="fu"><a href="../reference/clustering.html">clustering</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="va">co</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="va">co</span><span class="op">$</span><span class="va">A</span>
<span class="co">#&gt; $cluster1</span>
<span class="co">#&gt;                value_eur</span>
<span class="co">#&gt; (Intercept)  2.465358022</span>
<span class="co">#&gt; age         -0.063001748</span>
<span class="co">#&gt; pace        -0.001028232</span>
<span class="co">#&gt; shooting     0.033436542</span>
<span class="co">#&gt; dribbling    0.096580439</span>
<span class="co">#&gt; passing      0.015465307</span>
<span class="co">#&gt; defending    0.006060337</span>
<span class="co">#&gt; physic       0.034531890</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $cluster2</span>
<span class="co">#&gt;                value_eur</span>
<span class="co">#&gt; (Intercept)  1.648600273</span>
<span class="co">#&gt; age         -0.079781872</span>
<span class="co">#&gt; pace         0.003686812</span>
<span class="co">#&gt; shooting     0.004059577</span>
<span class="co">#&gt; dribbling    0.015195279</span>
<span class="co">#&gt; passing      0.008246014</span>
<span class="co">#&gt; defending    0.139825986</span>
<span class="co">#&gt; physic       0.030427394</span></code></pre></div>
<p>The two regression model extracted are quite different, one has an important weight for the defending ability and the physic. Whereas the player’s value is more influenced by the dribbling and shooting capabilities in the other regression model. The clustering seems therefore to have extracted two submarkets one for more defensive players and one for the other players. This can be confirmed by looking at the average position of the players of the two groups on the field:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Fifa_positions"</span><span class="op">)</span>
<span class="va">Xreg</span><span class="op">$</span><span class="va">cluster</span><span class="op">=</span><span class="fu"><a href="../reference/clustering.html">clustering</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="va">pos_clust_mean</span> <span class="op">=</span> <span class="va">Xreg</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://rpkgs.datanovia.com/ggpubr/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pos_x</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pos_y</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pos_clust_mean</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/background_image.html" class="external-link">background_image</a></span><span class="op">(</span><span class="va">Fifa_positions</span><span class="op">$</span><span class="va">bg_img</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,label<span class="op">=</span><span class="va">cluster</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">5</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span>ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">203.2</span><span class="op">)</span>,expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">101.6</span><span class="op">)</span>,expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="MoR_files/figure-html/unnamed-chunk-12-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Etienne Côme, Nicolas Jouvin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
