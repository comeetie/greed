<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continuous data clustering with Gaussian mixtures • greed</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Continuous data clustering with Gaussian mixtures">
<meta property="og:description" content="greed">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">greed</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GMM.html">Gaussian Mixture Models</a>
    </li>
    <li>
      <a href="../articles/LCA.html">Latent Class Analysis</a>
    </li>
    <li>
      <a href="../articles/MoR.html">Mixture of Regressions</a>
    </li>
    <li>
      <a href="../articles/SBM.html">Graph clustering</a>
    </li>
    <li>
      <a href="../articles/CombinedModels.html">Combined Models</a>
    </li>
    <li>
      <a href="../articles/MoM.html">Mixture of Multinomials</a>
    </li>
    <li>
      <a href="../articles/LBM.html">Co-clustering and LBM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a>
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/comeetie/greed" class="external-link">github</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="GMM_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Continuous data clustering with Gaussian mixtures</h1>
                        <h4 data-toc-skip class="author">Etienne Côme &amp; Nicolas Jouvin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/comeetie/greed/blob/HEAD/vignettes/GMM.Rmd" class="external-link"><code>vignettes/GMM.Rmd</code></a></small>
      <div class="hidden name"><code>GMM.Rmd</code></div>

    </div>

    
    
<style type="text/css">
p.caption {
  font-style: italic;
}
</style>
<p>Loads packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span> <span class="co"># allows parralel processing in greed()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://comeetie.github.io/greed/" class="external-link">greed</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2134</span><span class="op">)</span>

<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># may be increased </span></code></pre></div>
<div class="section level2">
<h2 id="the-model">The model<a class="anchor" aria-label="anchor" href="#the-model"></a>
</h2>
<p>Gaussian Mixture Models (GMMs) count among the most widely used <a href="https://arxiv.org/abs/2002.11577" class="external-link">DLVMs</a> for continuous data clustering. The <strong>greed</strong> package handles this family of models and implements efficient visualization tools for the clustering results that we detail below.</p>
<p>Without any constraints, the Bayesian formulation of GMMs leading to a tractable exact ICL expression uses a Normal and inverse-Wishart conjugate prior on the mean and covariances <span class="math inline">\(\mathbf{\theta} = (\mathbf{\mu}_k, \mathbf{\Sigma}_k)_k\)</span>. This prior is defined with hyperparameters <span class="math inline">\(\mathbf{\beta} = (\mathbf{\mu}, \tau, n_0, \mathbf{\varepsilon})\)</span> and the hierarchical model is written as follows:</p>
<span class="math display">\[\begin{equation}
\label{eq:gmm}
\begin{aligned}
\pi&amp;\sim \textrm{Dirichlet}_K(\alpha)\\
Z_i&amp;\sim \mathcal{M}(1,\pi)\\
\mathbf{\Sigma}_k^{-1} &amp; \sim \textrm{Wishart}(\mathbf{\varepsilon}^{-1},n_0)\\
\mathbf{\mu}_k&amp;\sim \mathcal{N}(\mathbf{\mu},\frac{1}{\tau} \mathbf{\Sigma}_k)\\
X_{i}|Z_{ik}=1 &amp;\sim \mathcal{N}(\mathbf{\mu}_k, \mathbf{\Sigma}_{k})\\
\end{aligned}
\end{equation}\]</span>
<p>Contrary to other models, these priors are informative and may therefore have a sensible impact on the obtained results. By default, the priors parameters are set as follow:</p>
<ul>
<li><span class="math inline">\(\alpha=1\)</span></li>
<li><span class="math inline">\(\mu=\bar{X}\)</span></li>
<li><span class="math inline">\(\tau=0.01\)</span></li>
<li><span class="math inline">\(n_0=d\)</span></li>
<li><span class="math inline">\(\mathbf{\varepsilon}=0.1\,\textrm{diag}(\mathbf{\hat{\Sigma}}_{\mathbf{X}})\)</span></li>
</ul>
<p>These default values were chosen to accommodate a variety of situation but may be modified easily. For more details, we refer to the class documentation <code><a href="../reference/Gmm.html">?Gmm</a></code>. Finally, it is possible to specify constraints on the covariance matrix as discussed below.</p>
</div>
<div class="section level2">
<h2 id="an-introductory-example-the-diabetes-dataset">An introductory example : the diabetes dataset<a class="anchor" aria-label="anchor" href="#an-introductory-example-the-diabetes-dataset"></a>
</h2>
<p>Let us describe a first use case on the <code>diabetes</code> dataset from the <strong>mclust</strong> package. The data describes <span class="math inline">\(p=3\)</span> biological variables for <span class="math inline">\(n=145\)</span> patients with <span class="math inline">\(K=3\)</span> different types of diabetes: normal, overt and chemical. We are interested in the clustering of this dataset to see if the three biological variables can discriminate between the three diabetes type.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">diabetes</span>,package<span class="op">=</span><span class="st">"mclust"</span><span class="op">)</span>
<span class="va">X</span><span class="op">=</span><span class="va">diabetes</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="co"># centering and scaling</span></code></pre></div>
<div class="section level3">
<h3 id="clustering-with-greed-and-gmm">Clustering with greed and GMM<a class="anchor" aria-label="anchor" href="#clustering-with-greed-and-gmm"></a>
</h3>
<p>We apply the <code><a href="../reference/greed.html">greed()</a></code> function with a <code>Gmm</code> object with default hyperparameters. The optimization algorithm used by default is the hybrid genetic algorithm of <a href="https://arxiv.org/abs/2002.11577" class="external-link">Come et. al (2021)</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sol</span> <span class="op">=</span> <span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">X</span>,model<span class="op">=</span><span class="fu"><a href="../reference/Gmm.html">Gmm</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Fitting a GMM model</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Initializing a population of 20 solutions.</span>
<span class="co">#&gt; ℹ Generation 1 : best solution with an ICL of -288 and 6 clusters.</span>
<span class="co">#&gt; ℹ Generation 2 : best solution with an ICL of -264 and 3 clusters.</span>
<span class="co">#&gt; ℹ Generation 3 : best solution with an ICL of -264 and 3 clusters.</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Final clustering</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Clustering with a GMM model 3 clusters and an ICL of -264</span></code></pre></div>
<p>The optimal clustering found by the hybrid GA has <span class="math inline">\(K^\star=3\)</span> clusters. You may then easily extract the found clustering with the <code><a href="../reference/clustering.html">clustering()</a></code> method and compare it with the known classes:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">diabetes</span><span class="op">$</span><span class="va">cl</span>,<span class="fu"><a href="../reference/clustering.html">clustering</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Chemical</td>
<td align="right">0</td>
<td align="right">24</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">Normal</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">74</td>
</tr>
<tr class="odd">
<td align="left">Overt</td>
<td align="right">26</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>It roughly corresponds to the known groups with cluster 1,2 and 3 recovering overt, chemical and normal diabetes respectively, with some missclassifications that are expected with GMM clustering on this dataset.</p>
<p>To get an overview of the clustering results, you may also use the <code><a href="../reference/gmmpairs.html">gmmpairs()</a></code> plot function which displays the scatter plot matrix, colored by cluster membership, with estimated Gaussian ellipses in each cluster via maximum a posteriori:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gmmpairs.html">gmmpairs</a></span><span class="op">(</span><span class="va">sol</span>,<span class="va">X</span><span class="op">)</span> </code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/diabetes-gmm-FIG-1.png" alt="Matrix pairs plots of the clustering with default hyperparameters on the diabetes data." width="90%"><p class="caption">
Matrix pairs plots of the clustering with default hyperparameters on the diabetes data.
</p>
</div>
<p>Furthermore, users may use the generic <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> function to get the mixture component parameters, or rather their maximum a posteriori estimated conditionally on the partition. The result will be a simple list with fields for each parameters (means: <code>muk</code>, covariance matrices: <code>Sigmak</code>, proportions: <code>pi</code>). Here is an example for the <span class="math inline">\(3\)</span>-component GMM we just extracted, were we extract the mean of the first component.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>
<span class="co">#&gt; [1] "pi"     "muk"    "Sigmak"</span>
<span class="va">params</span><span class="op">$</span><span class="va">muk</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt;       glucose  insulin      sspg</span>
<span class="co">#&gt; [1,] 1.871123 1.914675 -0.912741</span></code></pre></div>
<p>If a user wants to experiment with other values of the prior hyperparameters, the most important is <span class="math inline">\(\mathbf{\varepsilon}\)</span>, which control the clusters’ covariance matrices Wishart prior. This amounts to specify the prior on the dispersion inside each class. For instance, one may specify a priori belief that the variance is small inside clusters, which amounts to diminish the <span class="math inline">\(0.1\)</span> coefficient in front of <span class="math inline">\(\hat{\mathbf{\Sigma}}_{\mathbf{X}}\)</span>. In this case, it makes sense to decrease <span class="math inline">\(\tau\)</span> in the same proportions to keep a flat priors on the clusters means. For the diabetes data such a choice leads to an interesting solution, where the strong prior constraint leads to one cluster being created to fit one outlier in the “chemical” diabetes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sol_dense</span> <span class="op">=</span> <span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">X</span>,model<span class="op">=</span><span class="fu"><a href="../reference/Gmm.html">Gmm</a></span><span class="op">(</span>epsilon<span class="op">=</span><span class="fl">0.01</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, tau <span class="op">=</span><span class="fl">0.001</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Fitting a GMM model</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Initializing a population of 20 solutions.</span>
<span class="co">#&gt; ℹ Generation 1 : best solution with an ICL of -372 and 12 clusters.</span>
<span class="co">#&gt; ℹ Generation 2 : best solution with an ICL of -328 and 7 clusters.</span>
<span class="co">#&gt; ℹ Generation 3 : best solution with an ICL of -306 and 5 clusters.</span>
<span class="co">#&gt; ℹ Generation 4 : best solution with an ICL of -306 and 5 clusters.</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Final clustering</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Clustering with a GMM model 3 clusters and an ICL of -304</span>
<span class="fu"><a href="../reference/gmmpairs.html">gmmpairs</a></span><span class="op">(</span><span class="va">sol_dense</span>,<span class="va">X</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/diabetes-gmm-0.01-1.png" alt="Matrix pairs plots of the clustering with user specified hyperparameters on the diabetes data." width="90%"><p class="caption">
Matrix pairs plots of the clustering with user specified hyperparameters on the diabetes data.
</p>
</div>
</div>
<div class="section level3">
<h3 id="diagonal-covariance-matrix">Diagonal covariance matrix<a class="anchor" aria-label="anchor" href="#diagonal-covariance-matrix"></a>
</h3>
<p>When the number of variables <span class="math inline">\(p\)</span> becomes large, it can be of interest to reduce the flexibility of a GMM by adding a specific set of constraints. The diagonal covariance model, with constraint <span class="math inline">\(\mathbf{\Sigma}_k = \textrm{diag}(\sigma_{k1}, \ldots, \sigma_{kp})\)</span>, is implemented in the <strong>greed</strong> package through its <code>DiagGmm</code> S4 class. Its hierarchical formulation is similar to unconstrained GMM, except the Wishart prior on <span class="math inline">\(\mathbf{\Sigma}_k\)</span> is now replaced by a Gamma prior on each <span class="math inline">\(\sigma_{kj}\)</span> with shape <span class="math inline">\(\kappa\)</span> and rate <span class="math inline">\(\beta\)</span> hyperparameters defaulted to <span class="math inline">\(1\)</span> and mean of the empirical columns variances respectively.</p>
<p>Fitting this model on the diabetes dataset, <code><a href="../reference/greed.html">greed()</a></code> with an hybrid GA finds a <span class="math inline">\(4\)</span>-components diagonal GMM.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">soldiag</span> <span class="op">=</span> <span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">X</span>,model<span class="op">=</span><span class="fu"><a href="../reference/DiagGmm.html">DiagGmm</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Fitting a DIAGGMM model</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Initializing a population of 20 solutions.</span>
<span class="co">#&gt; ℹ Generation 1 : best solution with an ICL of -292 and 6 clusters.</span>
<span class="co">#&gt; ℹ Generation 2 : best solution with an ICL of -285 and 6 clusters.</span>
<span class="co">#&gt; ℹ Generation 3 : best solution with an ICL of -284 and 6 clusters.</span>
<span class="co">#&gt; ℹ Generation 4 : best solution with an ICL of -284 and 6 clusters.</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Final clustering</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Clustering with a DIAGGMM model 5 clusters and an ICL of -278</span>
<span class="fu"><a href="../reference/gmmpairs.html">gmmpairs</a></span><span class="op">(</span><span class="va">soldiag</span>,<span class="va">X</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/diabetes-diaggmm-1.png" alt="Matrix pairs plots of the Diagonal GMM clustering with default parameters on the diabetes data." width="90%"><p class="caption">
Matrix pairs plots of the Diagonal GMM clustering with default parameters on the diabetes data.
</p>
</div>
<p>As previously, the clustering is quite aligned with the known groups except that now two clusters were needed to fit the “overt” class which presents an important ellongation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">diabetes</span><span class="op">$</span><span class="va">cl</span>,<span class="fu"><a href="../reference/clustering.html">clustering</a></span><span class="op">(</span><span class="va">soldiag</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Chemical</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">27</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Normal</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">71</td>
</tr>
<tr class="odd">
<td align="left">Overt</td>
<td align="right">11</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Moreover, we may investigate coarser partitions when inspecting a clustering. To plot the dendogram, one may simply use the plot function with the type option set to <code>'tree'</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soldiag</span>,type<span class="op">=</span><span class="st">'tree'</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/diabetes-diaggmm-tree-1.png" alt="Dendogram extracted with a DiagGmm model on the diabetes data." width="60%"><p class="caption">
Dendogram extracted with a DiagGmm model on the diabetes data.
</p>
</div>
<p>Then, one may use the <code><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut()</a></code> to extract a new clustering at any level of the hierarchy. Here is the solution at <span class="math inline">\(K=3\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">solK3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">soldiag</span>, K<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">diabetes</span><span class="op">$</span><span class="va">cl</span>,<span class="fu"><a href="../reference/clustering.html">clustering</a></span><span class="op">(</span><span class="va">solK3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Chemical</td>
<td align="right">0</td>
<td align="right">28</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Normal</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">71</td>
</tr>
<tr class="odd">
<td align="left">Overt</td>
<td align="right">30</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Again, the clusters are relevant compared to the known groups.</p>
<p>Eventually, we may compare the ICL values between the full and diagonal models, using the <code>ICL</code> method and compute their difference to get a quantity similar to Bayes factor with the difference that the partition was not marginalized out, but optimized.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Full GMM has an ICL = '</span>, <span class="fu"><a href="../reference/ICL.html">ICL</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span>, <span class="st">'.\n'</span><span class="op">)</span>
<span class="co">#&gt; Full GMM has an ICL =  -263.9857 .</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Diagonal GMM has an ICL = '</span>, <span class="fu"><a href="../reference/ICL.html">ICL</a></span><span class="op">(</span><span class="va">soldiag</span><span class="op">)</span>, <span class="st">'.\n'</span><span class="op">)</span>
<span class="co">#&gt; Diagonal GMM has an ICL =  -278.1018 .</span>
<span class="va">bayesfactor</span> <span class="op">=</span> <span class="fu"><a href="../reference/ICL.html">ICL</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="../reference/ICL.html">ICL</a></span><span class="op">(</span><span class="va">soldiag</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Bayes factor = '</span>, <span class="va">bayesfactor</span>, <span class="st">'.\n'</span><span class="op">)</span>
<span class="co">#&gt; Bayes factor =  14.11607 .</span></code></pre></div>
<p>The full model achieved a quite better fit on this dataset.</p>
<blockquote>
<p><strong>Note:</strong> A note on caution on these statistics which take into account the chosen hyperparmaters and may therefore be influenced by the chosen values, as a classical bayes factor. These value must therefore be chosen with care and eventually their impact investigated with a sensibility analysis.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="high-dimensional-example-the-fashion-mnist-dataset">High-dimensional example : the fashion MNIST dataset<a class="anchor" aria-label="anchor" href="#high-dimensional-example-the-fashion-mnist-dataset"></a>
</h2>
<p>As explained above, diagonal models are attractive when working in high-dimensional settings. Their interest is twofold. First, the number of free parameters in the generative model is reduced, which is useful to reduce computational time even though they are integrated out in the ICL. Second, the prior maybe defined such that it will be less informative. We illustrate this with a subset of the <code>fashion-mnist</code> data provided with the package which contains <span class="math inline">\(p=784\)</span> dimensional vectors (corresponding to 28x28 flattened images of clothing). In this setting, the optimization algorithm is switched to <code>?`seed-class`</code>, which, while a bit less efficient than the hybrid algorithm used by default in <code><a href="../reference/greed.html">greed()</a></code>, has a lowest computational burden since it relies on a single and carefully chosen seeded initialization. In addition, we also increase the initial value for <span class="math inline">\(K\)</span> in order to compensate for the <code>seed</code> method’s inability to find a value of <span class="math inline">\(K\)</span> bigger than its initialization.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fashion"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fashion</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="co">#&gt; [1] 1000  784</span>
<span class="va">sol_fashion</span><span class="op">=</span><span class="fu"><a href="../reference/greed.html">greed</a></span><span class="op">(</span><span class="va">fashion</span><span class="op">$</span><span class="va">X</span>,model<span class="op">=</span><span class="fu"><a href="../reference/DiagGmm.html">DiagGmm</a></span><span class="op">(</span><span class="op">)</span>,alg<span class="op">=</span><span class="fu"><a href="../reference/Seed-class.html">Seed</a></span><span class="op">(</span><span class="op">)</span>,K<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Fitting a DIAGGMM model</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Final clustering</span> ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Clustering with a DIAGGMM model 22 clusters and an ICL of -3588313</span></code></pre></div>
<p>On this more complex dataset, the clustering found by the algorithm has <span class="math inline">\(K=23\)</span> clusters and the dendrogram proves very informative, highlighting the complex structure of these data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol_fashion</span>,type<span class="op">=</span><span class="st">'tree'</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/fashion-tree-1.png" alt="Dendogram extracted with a DiagGmm model on the fashionMNIST data." width="60%"><p class="caption">
Dendogram extracted with a DiagGmm model on the fashionMNIST data.
</p>
</div>
<p>Finally, the clusters centers look coherent and the hierarchical ordering underlines a form of “geometric proximities” between cluster objects.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_clust_centers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">clust_centers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">$</span><span class="va">muk</span>
  <span class="va">im_list</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">sol</span><span class="op">@</span><span class="va">K</span>,<span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">28</span><span class="op">:</span><span class="fl">1</span>,each<span class="op">=</span><span class="fl">28</span><span class="op">)</span>,j<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">28</span>,<span class="fl">28</span><span class="op">)</span>,v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">clust_centers</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,k<span class="op">=</span><span class="va">k</span><span class="op">)</span>
      <span class="op">}</span><span class="op">)</span>
  
  <span class="va">ims</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">im_list</span><span class="op">)</span>
  <span class="va">gg</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ims</span><span class="op">)</span><span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">i</span>,x<span class="op">=</span><span class="va">j</span>,fill<span class="op">=</span><span class="va">v</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ffffff"</span>,<span class="st">"#000000"</span><span class="op">)</span>,guide<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">k</span><span class="op">)</span><span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">gg</span><span class="op">)</span>
<span class="op">}</span> 
<span class="fu">plot_clust_centers</span><span class="op">(</span><span class="va">sol_fashion</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/fashion-means-1.png" alt="Visualization of the clusters centers extracted on the FashionMNIST data." width="90%"><p class="caption">
Visualization of the clusters centers extracted on the FashionMNIST data.
</p>
</div>
<p>As already demonstrated, the clustering can be cut at a coarser levels, if one wants a more synthetic result. We may for example look at the centers for the <span class="math inline">\(7\)</span>-components clustering:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sol_fashion_K7</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">sol_fashion</span>, K<span class="op">=</span><span class="fl">7</span><span class="op">)</span>
<span class="fu">plot_clust_centers</span><span class="op">(</span><span class="va">sol_fashion_K7</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GMM_files/figure-html/fashion-K7-1.png" alt="Visualization of the clusters centers extracted on the FashionMNIST data at a coarser level." width="700"><p class="caption">
Visualization of the clusters centers extracted on the FashionMNIST data at a coarser level.
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Etienne Côme, Nicolas Jouvin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
