---
title: "missingdata"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{missingdata}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


```{r setup,message=FALSE,results='hide',fig.width=6}
library(greed)
library(missSBM)
library(dplyr)
library(ggplot2)

# simu params
epsi = 0.05
N=100
mu = list(mean=(diag(3)*(1-epsi)) + (matrix(1,3,3)-diag(3))*epsi)
Nbsim = 100
# to store greed res
Kh = rep(0,Nbsim)
NMIh = rep(0,Nbsim)
ARIh = rep(0,Nbsim)
# for vem
Kms = rep(0,Nbsim)
NMIms = rep(0,Nbsim)
ARIms = rep(0,Nbsim)

for (isim in 1:Nbsim){
  # simulate data
  sbm = sbm::sampleSimpleSBM(N,c(1/3,1/3,1/3),mu)
  X=sbm$networkData
  Xo = observeNetwork(X,"double-standard",c(0.1,0.25))
  Xc = to_multinomial(Xo)
  
  # greed
  sol=greed(Xc)
  Kh[isim]=sol@K
  NMIh[isim]=NMI(sbm$memberships,sol@cl)
  ARIh[isim]=aricode::ARI(sbm$memberships,sol@cl)
  
  # vem
  ms=estimateMissSBM(Xo,vBlocks = 1:10,sampling="double-standard")
  Kms[isim]=ms$bestModel$fittedSBM$nbBlocks
  NMIms[isim]=NMI(sbm$memberships,ms$bestModel$fittedSBM$memberships)
  ARIms[isim]=aricode::ARI(sbm$memberships,ms$bestModel$fittedSBM$memberships)
}
# plot
res = tibble(ari=ARIh,nmi=NMIh,K=Kh,alg="greed") %>% bind_rows(tibble(ari=ARIms,nmi=NMIms,K=Kms,alg="vem"))
ggplot(res)+geom_boxplot(aes(y=nmi,x=alg))+geom_jitter(aes(y=nmi,x=alg))
ggplot(res)+geom_boxplot(aes(y=ari,x=alg))+geom_jitter(aes(y=nmi,x=alg))
ggplot(res)+geom_bar(aes(x=K))+facet_wrap(~alg)+scale_x_continuous(breaks=1:10,labels=1:10)
```
