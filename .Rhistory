l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
lab[l]=cn+1
fpos = xpos[l]
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
soltemp=sol
soltemp@x_counts=soltemp@x_counts[order(xpos),order(xpos)]
soltemp@counts=as.matrix(soltemp@counts[order(xpos)])
plot(soltemp)
plot(sol)
path=pathsol@path
tree =c(0)
cn  = 1
lab = c(1)
xpos = c(0)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
pl = length(path)-lev
print(w^pl)
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
lab[l]=cn+1
fpos = xpos[l]
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
soltemp=sol
soltemp@x_counts=soltemp@x_counts[order(xpos),order(xpos)]
soltemp@counts=as.matrix(soltemp@counts[order(xpos)])
plot(soltemp)
length(tree)
lab
soltemp=sol
soltemp@x_counts=soltemp@x_counts[order(sol@counts),order(sol@counts)]
soltemp@counts=as.matrix(soltemp@counts[order(sol@counts)])
plot(soltemp)
path[[length(path)]]
path[[length(path)-1]]
path[[length(path)-3]]
path[[length(path)]]
path=pathsol@path
tree =c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,pathsol@K+pathsol@K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
pl = length(path)-lev
print(w^pl)
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=path[[lev]]$logalpha
lab[l]=cn+1
fpos = xpos[l]
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
H = rep(0,pathsol@K+pathsol@K-1)
pathsol@K
pathsol@counts
length(pathsol@counts)
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
pl = length(path)-lev
print(w^pl)
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=path[[lev]]$logalpha
lab[l]=cn+1
fpos = xpos[l]
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
pathsol@path = path
pathsol@tree = tree
H
which(H)==0
which(H==0)
length(which(H==0))
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
pl = length(path)-lev
print(w^pl)
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=-path[[lev]]$logalpha
lab[l]=cn+1
fpos = xpos[l]
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
H
tree
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
xtree=c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
pl = length(path)-lev
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=-path[[lev]]$logalpha
lab[l]=cn+1
fpos = xpos[l]
xtree=c(xtree,fpos-w^pl,fpos+w^pl)
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
data.frame(H=H,tree=tree,x=xtree)
gg=data.frame(H=H,tree=tree,x=xtree)
ggplot(gg)+geom_point(aes(x=x,y=H))
library(ggplot2)
ggplot(gg)+geom_point(aes(x=x,y=H))
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
xtree=c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
print(xpos)
pl = length(path)-lev
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=-path[[lev]]$logalpha
lab[l]=cn+1
fpos = xpos[l]
xtree=c(xtree,fpos-w^pl,fpos+w^pl)
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,lab[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
xtree=c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
print(xpos)
pl = length(path)-lev
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=-path[[lev]]$logalpha
lab[l]=cn+1
fpos = xpos[l]
xtree=c(xtree,fpos-w^pl,fpos+w^pl)
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,xpos[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
gg=data.frame(H=H,tree=tree,x=xtree)
ggplot(gg)+geom_point(aes(x=x,y=H))
soltemp=sol
soltemp@x_counts=soltemp@x_counts[order(xpos),order(xpos)]
soltemp@counts=as.matrix(soltemp@counts[order(xpos)])
plot(soltemp)
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
xtree=c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
print(xpos)
pl = length(path)-lev
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=-path[[lev]]$logalpha
if(H[lab[l]]>H[tree[lab[l]]]){
H[lab[l]]=H[tree[lab[l]]]
}
lab[l]=cn+1
fpos = xpos[l]
xtree=c(xtree,fpos-w^pl,fpos+w^pl)
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,xpos[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
gg=data.frame(H=H,tree=tree,x=xtree)
ggplot(gg)+geom_point(aes(x=x,y=H))
K=length(pathsol@counts)
path=pathsol@path
tree =c(0)
xtree=c(0)
cn  = 1
lab = c(1)
xpos = c(0)
H = rep(0,2*K-1)
x = 0
w = 0.5
K=1
for (lev in seq(length(path),1)){
print(xpos)
pl = length(path)-lev
path[[lev]]$lab  = lab
path[[lev]]$xpos = xpos
path[[lev]]$perm = order(xpos)
k=path[[lev]]$k
l=path[[lev]]$l
tree=c(tree,lab[l],lab[l])
H[lab[l]]=-path[[lev]]$logalpha
if(tree[lab[l]]!=0 && H[lab[l]]>H[tree[lab[l]]]){
H[lab[l]]=H[tree[lab[l]]]
}
lab[l]=cn+1
fpos = xpos[l]
xtree=c(xtree,fpos-w^pl,fpos+w^pl)
xpos[l]=fpos-w^pl
if(k>K){
xpos = c(xpos,fpos+w^pl)
lab=c(lab,cn+2)
}else{
xpos = c(xpos[1:(k-1)],fpos+w^pl,xpos[k:length(lab)])
lab=c(lab[1:(k-1)],cn+2,lab[k:length(lab)])
}
K  = K+1
cn = cn + 2
}
gg=data.frame(H=H,tree=tree,x=xtree)
ggplot(gg)+geom_point(aes(x=x,y=H))
gg=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
?geom_segment
ggplot(gg)+geom_point(aes(x=x,y=H))+geom_segment(aes(x=x,y=H,xend=gg$x[gg$tree[node]],yend=gg$H[gg$tree[node]]))
gg=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
ggplot(gg)+geom_point(aes(x=x,y=H))+geom_segment(aes(x=x,y=H,xend=gg$x[gg$tree[node]],yend=gg$H[gg$tree[node]]))
ggplot(gg)+geom_point(aes(x=x,y=H))+geom_segment(aes(x=gg$x,y=gg$H,xend=gg$x[gg$tree[gg$node]],yend=gg$H[gg$tree[gg$node]]))
gg$H[gg$tree[gg$node]]
gg$x[gg$tree[gg$node]]
gg$H
ggplot(gg)+geom_segment(aes(x=gg$x,y=gg$H,xend=gg$x[gg$tree[gg$node]],yend=gg$H[gg$tree[gg$node]]))
elngth(gg$x[gg$tree[gg$node]])
length(gg$x[gg$tree[gg$node]])
ggplot(gg[-1,])+geom_point(aes(x=x,y=H))+geom_segment(aes(x=gg$x,y=gg$H,xend=gg$x[gg$tree[gg$node]],yend=gg$H[gg$tree[gg$node]]))
gg=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
gg=gg[-1,]
ggplot(gg)+geom_point(aes(x=x,y=H))+geom_segment(aes(x=gg$x,y=gg$H,xend=gg$x[gg$tree[gg$node]],yend=gg$H[gg$tree[gg$node]]))
cbind(gg$x,gg$x[gg$tree[gg$node]])
tree
length(tree)
H
xtree
tree
gg$node
gg$tree
gg$xpos
gg$x
ggplot(gg)+geom_point(aes(x=x,y=H))+geom_segment(aes(x=gg$x,y=gg$H,xend=gg$x[gg$tree],yend=gg$H[gg$tree]))
ggplot(gg)+geom_segment(aes(x=gg$x,y=gg$H,xend=gg$x[gg$tree],yend=gg$H[gg$tree]))+geom_point(aes(x=x,y=H))
ggplot(gg)+geom_point(aes(x=x,y=H))
gg=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
gg
gg$tree
gg$H[gg$tree]
c(infty,gg$H[gg$tree])
c(-1,gg$H[gg$tree])
gg$xend = c(-1,gg$x[gg$tree])
ggplot()+geom_segment(data=gg[-1,],aes(x=x,y=H,xend=xend,yend=Hend))+geom_point(data=gg,aes(x=x,y=H))
gg=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
gg$Hend = c(-1,gg$H[gg$tree])
gg$xend = c(-1,gg$x[gg$tree])
ggplot()+geom_segment(data=gg[-1,],aes(x=x,y=H,xend=xend,yend=Hend))+geom_point(data=gg,aes(x=x,y=H))
xpos
order(xpos)
ggtree=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
# recalculer les x
leafs = which(ggtree$H==0)
or = order(ggtree[leafs,"x"])
ggtree$x[leafs[or]]=seq(-1,1,length.out = length(leafs))
for(n in setdiff(1:nrow(ggtree),leafs)){
sons=which(ggtree$father==n)
ggtree$x[n]=mean(ggtree$x[sons])
ggtree$xmin[n] = min(ggtree$x[sons])
ggtree$xmax[n] = max(ggtree$x[sons])
}
warning()
warnings()
ggtree=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
# recalculer les x
leafs = which(ggtree$H==0)
or = order(ggtree[leafs,"x"])
ggtree$x[leafs[or]]=seq(-1,1,length.out = length(leafs))
for(n in setdiff(1:nrow(ggtree),leafs)){
sons=which(ggtree$father==n)
ggtree$x[n]=mean(ggtree$x[sons])
ggtree$xmin[n] = min(ggtree$x[sons])
ggtree$xmax[n] = max(ggtree$x[sons])
}
warnings()
ggtree=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
# recalculer les x
leafs = which(ggtree$H==0)
or = order(ggtree[leafs,"x"])
ggtree$x[leafs[or]]=seq(-1,1,length.out = length(leafs))
for(n in setdiff(1:nrow(ggtree),leafs)){
sons=which(ggtree$tree==n)
ggtree$x[n]=mean(ggtree$x[sons])
ggtree$xmin[n] = min(ggtree$x[sons])
ggtree$xmax[n] = max(ggtree$x[sons])
}
ggtree
ggplot()+geom_segment(aes(x=ggleaf$x,y=ggleaf$H,xend=ggleaf$x,yend=ggtree$H[ggleaf$father]))+
geom_segment(data=ggtree[ggtree$H>0,],aes(x=xmin,y=H,xend=xmax,yend=H))+
#geom_point(data=roots,aes(x=x,y=H),color="red")+
scale_x_continuous("",labels = c(),breaks = c())+
scale_y_continuous("-log(alpha)")+theme_bw()
ggleaf=ggtree[ggtree$tree!=0,]
ggplot()+geom_segment(aes(x=ggleaf$x,y=ggleaf$H,xend=ggleaf$x,yend=ggtree$H[ggleaf$father]))+
geom_segment(data=ggtree[ggtree$H>0,],aes(x=xmin,y=H,xend=xmax,yend=H))+
#geom_point(data=roots,aes(x=x,y=H),color="red")+
scale_x_continuous("",labels = c(),breaks = c())+
scale_y_continuous("-log(alpha)")+theme_bw()
ggtree
ggplot()+geom_segment(data=gg[-1,],aes(x=x,y=H,xend=xend,yend=Hend))+geom_point(data=gg,aes(x=x,y=H))
ggplot()+geom_segment(data=ggtree[-1,],aes(x=x,y=H,xend=xend,yend=Hend))+geom_point(data=ggtree,aes(x=x,y=H))
ggtree$Hend = c(-1,ggtree$H[gg$tree])
ggtree$xend = c(-1,ggtree$x[gg$tree])
ggplot()+geom_segment(data=ggtree[-1,],aes(x=x,y=H,xend=xend,yend=Hend))+geom_point(data=ggtree,aes(x=x,y=H))
ggtree=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
# recalculer les x
leafs = which(ggtree$H==0)
ggtree
or = order(ggtree[leafs,"x"])
ggtree$x[leafs[or]]
ggtree$x[leafs[or]]=seq(-1,1,length.out = length(leafs))
leafs
others = setdiff(1:nrow(ggtree),leafs)
others
H[others]
H[others[order(H[others])]]
others[order(H[others])
]
ggtree=data.frame(H=H,tree=tree,x=xtree,node=1:length(tree))
# recalculer les x
leafs = which(ggtree$H==0)
or = order(ggtree[leafs,"x"])
ggtree$x[leafs[or]]=seq(-1,1,length.out = length(leafs))
others = setdiff(1:nrow(ggtree),leafs)
devtools::load_all("~/Projets/greed")
dim(Xs)
fit_greed(new("mm"),Xs,25)
fit(Xs,25,new("mm"))
fit_greed(new("mm"),Xs,25)
a=fit_greed(new("mm"),Xs,25)
devtools::load_all("~/Projets/greed")
a=fit_greed(new("mm"),Xs,25)
devtools::load_all("~/Projets/greed")
a=fit_greed(new("mm"),Xs,25)
a$cou
a@counts
plot(a)
a@x_counts
image(a@x_counts)
image(a@x_counts[,5])
a@x_counts[,5]
Iv[5]
names(X20news)[Iv[5]]
names(X20news)
X20news
col.names(X20news)[Iv[5]]
colnames(X20news)[Iv[5]]
fit(Xjazz,20)
library(future)
fit(Xjazz,20)
