while(length(fathers)>1){
leafs = tree[tree$node %in% fathers,]
rowtree = rbind(rowtree,leafs)
fathers = setdiff(unique(leafs$tree),rowtree$node)
fathers=fathers[fathers!=0]
}
ggtree=rowtree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))+
ggplot2::scale_x_continuous("",breaks=c())+
ggplot2::ylab(expression(paste("-log(",alpha,")")))
sol@ggtree
sol@ggtree$tree==0
solt=sol
library(dplyr)
solt@ggtree
solt@ggtree %>% filter(tree==0)
solt@ggtree %>% filter(H>4000)
solt = solt@ggtree %>% filter(H<4000)
greed:::dendo(solt)
solt=sol
solt@ggtree = solt@ggtree %>% filter(H<4000)
greed:::dendo(solt)
solt = solt@ggtree %>% filter(tree==0)
solt=sol
solt = solt@ggtree %>% filter(tree==0)
greed:::dendo(solt)
solt@ggtree = solt@ggtree %>% filter(tree==0)
solt=sol
solt@ggtree = solt@ggtree %>% filter(tree==0)
greed:::dendo(solt)
solt=sol
solt@ggtree = solt@ggtree %>% filter(tree!=0)
greed:::dendo(solt)
root=tree$node[tree$tree==0]
xcol=tree[tree$node %in% clust_cols,]$x
coltree=tree[tree$x>=min(xcol)&tree$x<=max(xcol),]
xcol=tree[tree$node %in% clust_cols,]$x
coltree=tree[tree$x>=min(xcol)&tree$x<=max(xcol),]
xrow=tree[tree$node %in% clust_rows,]$x
rowtree=tree[tree$x>=min(xrow)&tree$x<=max(xrow),]
ggtree=coltree
tree=ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree[-1,],ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))+
ggplot2::scale_x_continuous("",breaks=c())+
ggplot2::ylab(expression(paste("-log(",alpha,")")))
tree
tree=sol@ggtree
root=tree$node[tree$tree==0]
tree=tree[tree$node!=root,]
tree$tree[tree$tree==root]=0
ggtree=tree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree[-1,],ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))+
ggplot2::scale_x_continuous("",breaks=c())+
ggplot2::ylab(expression(paste("-log(",alpha,")")))
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))+
ggplot2::scale_x_continuous("",breaks=c())+
ggplot2::ylab(expression(paste("-log(",alpha,")")))
xcol=tree[tree$node %in% clust_cols,]$x
xcol
coltree=tree[tree$x>=min(xcol)&tree$x<=max(xcol),]
gggtree=coltree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))+
ggplot2::scale_x_continuous("",breaks=c())+
ggplot2::ylab(expression(paste("-log(",alpha,")")))
max(xcol)
min(xcol)
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
max(coltree$x)
ggtree=coltree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
xrow=tree[tree$node %in% clust_rows,]$x
rowtree=tree[tree$x>=min(xrow)&tree$x<=max(xrow),]
ggtree=rowtree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
library(greed)
colc=greed:::postprocess(sol)
plot(colc)
plot(colc,type='tree')
colc@ggtreerow$x
ggtree=colc@ggtreerow
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
tree=sol@ggtree
root=tree$node[tree$tree==0]
tree=tree[tree$node!=root,]
tree$tree[tree$tree==root]=0
xcol=tree[tree$node %in% clust_cols,]$x
coltree=tree[tree$x>=min(xcol)&tree$x<=max(xcol),]
xrow=tree[tree$node %in% clust_rows,]$x
rowtree=tree[tree$x>=min(xrow)&tree$x<=max(xrow),]
gggtree=rowtree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
xrow
dim(tree)
dim(coltree)
dim(rowtree)
range(rowtree$x)
ggtree=rowtree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
ggtree=coltree
ggplot2::ggplot()+ggplot2::geom_segment(data=ggtree[ggtree$node %in% ggtree$tree,],ggplot2::aes_(x=~xmin,y=~H,xend=~xmax,yend=~H))+
ggplot2::geom_segment(data=ggtree,ggplot2::aes_(x=~x,y=~H,xend=~x,yend=~Hend))
library(greed)
data("Jazz_full")
sol=greed(Jazz_full)
sol=greed(Jazz_full$X)
library(future)
plan(multisession)
sol=greed(Jazz_full$X)
plot(sol,type='tree')
data("Xvlegislature")
sol=greed(Xvlegislature$X,K=100)
plo(tsol,type='tree')
plot(sol,type='tree')
sol=greed(Jazz_full$X,K=100)
sol=greed(Jazz_full$X,K=60)
plot(sol)
plot(sol,type='tree')
Jazz_full$col_meta
Jazz_full$col_meta[sol@clcol==1]
Jazz_full$col_meta[sol@clcol==1,]
Jazz_full$col_meta[sol@clcol==2,]
Jazz_full$col_meta[sol@clcol==3,]
Jazz_full$col_meta[sol@clcol==4,]
Jazz_full$col_meta[sol@clcol==4,]$Band
Jazz_full$col_meta[sol@clcol==5,]$Band
Jazz_full$col_meta[sol@clcol==6,]$Band
Jazz_full$col_meta[sol@clcol==7,]$Band
Jazz_full$col_meta[sol@clcol==8,]$Band
row.names(Jazz_full$X)
Jazz_full$col_meta[sol@clcol==9,]$Band
knitr::opts_chunk$set(echo = TRUE)
Xc=Jazz_full$X[rowSums(Jazz_full$X)>2,]
Xc=Xc[,colSums(Xc)>2]
fit_cojazz = greed(Xc,alg=new("hybrid",pop_size=40),K=60)
plot(fit_cojazz)
plot(fit_cojazz,type='tree')
plot(cut(fit_cojazz,35))
plot(cut(fit_cojazz,35),type='tree')
plot(cut(fit_cojazz,33),type='tree')
plot(cut(fit_cojazz,32),type='tree')
plot(cut(fit_cojazz,31),type='tree')
plot(cut(fit_cojazz,30),type='tree')
plot(cut(fit_cojazz,28),type='tree')
plot(cut(fit_cojazz,25),type='tree')
plot(cut(fit_cojazz,22),type='tree')
plot(cut(fit_cojazz,22),type='tree')
plot(cut(fit_cojazz,20),type='tree')
plot(cut(fit_cojazz,21),type='tree')
plot(cut(fit_cojazz,22),type='tree')
plot(cut(fit_cojazz,22))
f22=cut(fit_cojazz,22)
nn=rownames(Xc)
nn[f22@clrow==3]
nn[f22@clrow==1]
nn[f22@clrow==2]
nn[f22@clrow==9]
cn=colnames(Xc)
cn[f22@clcol==2]
cn[f22@clcol==4]
nn[f22@clrow==11]
nn[f22@clrow==5]
nn[f22@clrow==2]
cn[f22@clcol==6]
cn[f22@clcol==5]
plot(fit_cojazz)
cn[f22@clcol==5,type='tree']
plot(fit_cojazz,type='tree')
library(CARTElette)
dat=charger_carte(nivsupra = "COM")
a=sf::st_centroid(dat)
cent = sf::st_centroid(sf::st_transform(dat,2154))
library(dplyr)
cent = sf::st_centroid(sf::st_transform(dat %>% filter(INSEE_DEP==77),2154))
plot(cent)
sf::st_voronoi(cent)
plot(sf::st_voronoi(cent))
plot(sf::st_voronoi(cent %>% sf::st_geometry()))
plot(sf::st_voronoi(cent %>% sf::st_geometry() %>% head(50)))
plot(cent %>% sf::st_geometry() %>% head(50))
tp=cent %>% sf::st_geometry() %>% head(50)
?sf::st_voronoi
plot(sf::st_voronoi(tp,sf::st_convex_hull(tp)))
plot(sf::st_convex_hull(tp))
plot(st_buffer(sf::st_convex_hull(tp),500))
plot(sf::st_buffer(sf::st_convex_hull(tp),500))
library(sf)
plot(sf::st_buffer(sf::st_convex_hull(tp),500))
plot(sf::st_buffer(sf::st_convex_hull(tp),500))
envel=sf::st_buffer(sf::st_convex_hull(tp),500))
envel=sf::st_buffer(sf::st_convex_hull(tp),500)
envel
envel=sf::st_buffer(sf::st_convex_hull(st_union(tp)),500))
envel=sf::st_buffer(sf::st_convex_hull(st_union(tp)),500)
envel
plot(envel)
envel=sf::st_buffer(sf::st_convex_hull(st_union(tp)),5000)
plot(envel)
plot(sf::st_voronoi(st_union(tp),envel)
)
plot(sf::st_voronoi(tp,envel)
)
plot(sf::st_voronoi(tp,envel))
plot(sf::st_voronoi(tp,envel)
)
st_voronoi(tp,envel)
tp
?st_voronoi
st_voronoi(tp,envel)
st_voronoi(st_union(tp),envel)
a=st_voronoi(st_union(tp),envel)
plot(a)
st_voronoi(tp,envel)
vo=st_voronoi(tp,envel)
plot(vo[1])
st_union(tp)
vo=st_voronoi(st_union(tp),envel%>% st_geometry())
plot(vo)
plot(vo,col=0)
plot(envel)
vo=st_voronoi(st_union(tp),envelope = envel%>% st_geometry())
plot(vo,col=0)
plot(st_buffer(vo,5000),col=0)
plot(st_buffer(vo,500),col=0)
vo
plot(st_buffer(vo %>% st_collection_extract(),500),col=0)
plot(st_buffer(vo %>% st_collection_extract(),5000),col=0)
plot(st_buffer(vo %>% st_collection_extract(),1500),col=0)
?st_buffer
plot(st_buffer(vo %>% st_collection_extract(),-1500),col=0)
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000),col=0)
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000))
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000),col="red")
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000),col="#124545")
cent = sf::st_centroid(sf::st_transform(dat %>% filter(INSEE_DEP==77),2154))
envel=sf::st_buffer(sf::st_convex_hull(st_union(tp)),5000)
vo=st_voronoi(st_union(tp),envel%>% st_geometry())
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000),col=0)
cent = sf::st_centroid(sf::st_transform(dat %>% filter(INSEE_DEP==77),2154)%>%st_geometry())
dat=charger_carte(nivsupra = "COM")
cent = sf::st_centroid(sf::st_transform(dat %>% filter(INSEE_DEP==77),2154)%>%st_geometry())
envel=sf::st_buffer(sf::st_convex_hull(st_union(tp)),5000)
vo=st_voronoi(st_union(tp),envel%>% st_geometry())
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000),col="#124545")
vo=st_voronoi(st_union(tp))
plot(st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000),col="#124545")
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000)
plot(st_intersection(vo_buf,envel),col="#124545")
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-2000),1000)
plot(st_intersection(vo_buf,envel),col="#124545")
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-200),100)
plot(st_intersection(vo_buf,envel),col="#124545")
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-400),200)
plot(st_intersection(vo_buf,envel),col="#124545")
library(osmr)
library(osmdata)
get_bb("ile de france")
library(osmdata)
bb=get_bb("ile de france")
bb=getbb("ile de france")
bb
qr=bb %>% opq() %>% add_osm_feature("railway","station")
dat=osmdata(qr)
dat
dat$overpass_call
q2 <- getbb ("portsmouth", display_name_contains = "USA") %>%
opq () %>%
add_osm_feature("amenity", "pub")
qr=bb %>% opq() %>% add_osm_feature("amenity","pub")
dat=osmdata(qr)
dat
update.packages("osmdata")
x <- opq(bbox = c(-0.27, 51.47, -0.20, 51.50)) %>% # Chiswick Eyot in London, U.K.
add_osm_feature(key = 'name', value = "Thames", value_exact = FALSE) %>%
osmdata_sf()
x
bb=getbb("paris")
qr=bb %>% opq() %>% add_osm_feature("amenity","pub")
dat=osmdata(qr)
dat
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata(qr)
dat
dat=osmdata_sf(qr)
dat
dat = dat$osm_points
cent = sf::st_transform(dat,2154)
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-400),200)
plot(st_intersection(vo_buf,envel),col="#124545")
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-40),20)
plot(st_intersection(vo_buf,envel),col="#124545")
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-100),50)
plot(st_intersection(vo_buf,envel),col="#124545")
bb=getbb("berlin")
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata_sf(qr)
dat = dat$osm_points
cent = sf::st_transform(dat,2154)
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-100),50)
plot(st_intersection(vo_buf,envel),col="#124545")
vo %>% st_collection_extract() %>% st_area()
sqrt(vo %>% st_collection_extract() %>% st_area())
mean(sqrt(vo %>% st_collection_extract() %>% st_area())/10)
bb=getbb("berlin")
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata_sf(qr)
dat = dat$osm_points
cent = sf::st_transform(dat,2154)
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area())/10)
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
plot(st_intersection(vo_buf,envel),col="#124545")
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/20
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
plot(st_intersection(vo_buf,envel),col="#124545")
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/15
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
plot(st_intersection(vo_buf,envel),col="#124545")
bb=getbb("london")
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata_sf(qr)
dat = dat$osm_points
cent = sf::st_transform(dat,2154)
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/15
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
plot(st_intersection(vo_buf,envel),col="#124545")
cols= c("#9e0142","#d53e4f,"#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
)
cols= c("#9e0142","#d53e4f,"#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
length(vo_buf)
sample(cols,length(vo_buf))
sample(cols,length(vo_buf),replace = TRUE)
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
bb=getbb("ile de france")
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata_sf(qr)
bb=getbb("seine et marne")
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata_sf(qr)
dat = dat$osm_points
cent = sf::st_transform(dat,2154)
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/15
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
space = median(sqrt(vo %>% st_collection_extract() %>% st_area()))/15
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
space = median(sqrt(vo %>% st_collection_extract() %>% st_area()))
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
space = median(sqrt(vo %>% st_collection_extract() %>% st_area()))/5
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
bb=getbb("indre et loire")
qr=bb %>% opq() %>% add_osm_feature(key="railway",value="station")
dat=osmdata_sf(qr)
dat = dat$osm_points
cent = sf::st_transform(dat,2154)
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
space = median(sqrt(vo %>% st_collection_extract() %>% st_area()))/5
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
space = median(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
# install.packages("devtools")
devtools::install_github("will-r-chase/poissondisc")
library(poissondisc)
pts <- poisson_disc(400, 400, 20)
pts
pts
dat=st_as_sf(pts,coords = c("x","y"))
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
cent=st_as_sf(pts,coords = c("x","y"))
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),5000)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)))
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),100)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),10)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
plot(st_intersection(vo_buf,envel),col="#000")
plot(st_intersection(vo_buf,envel),col="#000000")
cent
#envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),10)
envel=st_buffer(st_as_sf(data.frame(x=200,y=200),coords = c("x","y")),200)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
bb=getbb("indre et loire")
qr=bb %>% opq() %>% add_osm_feature(key="highway",value="primary")
dat=osmdata_sf(qr)
plot(dat$osm_lines)
plot(dat$osm_lines %>% st_geometry())
pts <- poisson_disc(400, 400, 20)
cent=st_as_sf(pts,coords = c("x","y"))
#envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),10)
envel=st_buffer(st_as_sf(data.frame(x=200,y=200),coords = c("x","y")),200)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(vo %>% st_collection_extract(),-space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
#envel=sf::st_buffer(sf::st_convex_hull(st_union(cent)),10)
envel=st_buffer(st_as_sf(data.frame(x=200,y=200),coords = c("x","y")),150)
vo=st_voronoi(st_union(cent))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
vo=st_voronoi(st_union(cent %>% filter(st_within(cent,envel))))
st_within(cent,envel)
st_within(cent,envel)==1
as.vector(st_within(cent,envel))
sapply(st_within(cent,envel),length)==1
vo=st_voronoi(st_union(cent %>% filter(sapply(st_within(cent,envel),length)==1)))
space = mean(sqrt(vo %>% st_collection_extract() %>% st_area()))/10
vo_buf=st_buffer(st_buffer(vo %>% st_collection_extract(),-space),space/2)
cols= c("#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2")
plot(st_intersection(vo_buf,envel),col=sample(cols,length(vo_buf),replace = TRUE))
qr=bb %>% opq() %>% add_osm_feature(key="waterway")
bb=getbb("indre et loire")
qr=bb %>% opq() %>% add_osm_feature(key="waterway")
dat=osmdata_sf(qr)
qr=bb %>% opq(timeout = 180) %>% add_osm_feature(key="waterway")
dat=osmdata_sf(qr)
plot(dat$osm_lines %>% st_geometry())
plot(dat$osm_polygons %>% st_geometry(),add=TRUE)
rivers=st_read("../HydroRIVERS_v10_eu_shp/HydroRIVERS_v10_eu.shp")
rivers
plot(rivers)
plot(rivers(1,))
plot(rivers[1,])
rivers %>% group_by(HYBAS_L12) %>% summarise(n=n())
library(dplyr)
library(sf)
setwd("/data/Projets/art")
rivers=st_read("../HydroRIVERS_v10_eu_shp/HydroRIVERS_v10_eu.shp")
rivers %>% group_by(HYBAS_L12) %>% summarise(n=n())
rivers%>% st_drop_geometry() %>% group_by(HYBAS_L12) %>% summarise(n=n())
rivers%>% st_drop_geometry() %>% group_by(HYBAS_L12) %>% summarise(n=n()) %>% arrange(n)
rivers%>% st_drop_geometry() %>% group_by(HYBAS_L12) %>% summarise(n=n()) %>% arrange(desc(n))
plot(rivers %>% filter(HYBAS_L12==2120059210))
plot(rivers %>% filter(HYBAS_L12==2120059210) %>% st_geometry())
plot(rivers %>% filter(HYBAS_L12==2120057410) %>% st_geometry())
bass=st_read("../HydroRIVERS_v10_eu_shp/eu_bas_15s_beta/eu_bas_15s_beta.shp")
bass
leq
a=matrix(5,2,3)
a
is.(a,"matrix")
is(a,"matrix")
